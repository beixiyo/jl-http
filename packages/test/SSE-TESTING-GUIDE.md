# SSE 功能测试指南

本指南介绍如何使用本项目提供的 SSE (Server-Sent Events) 测试功能。

## 🚀 快速开始

1. **启动开发服务器**
   ```bash
   cd packages/test
   pnpm dev
   ```

2. **访问测试页面**
   打开浏览器访问: `http://localhost:5173/http-sse`

3. **选择测试端点**
   页面提供了多个预设的 SSE 端点，点击"加载配置"按钮即可快速配置

## 📡 可用的 SSE 接口

### 1. 基础数据流 (`/api/sse/stream`)
- **用途**: 测试基本的 SSE 连接和数据接收
- **特点**: 每秒发送一条消息，共10条
- **数据格式**: JSON 格式的结构化数据
- **适用场景**: 基础功能测试、连接稳定性测试

### 2. 聊天对话流 (`/api/sse/chat`)
- **用途**: 模拟 AI 聊天的流式回复
- **特点**: 逐字符发送，模拟真实的打字效果
- **请求方式**: POST，需要发送 JSON 请求体
- **适用场景**: 聊天应用、AI 对话系统测试

### 3. 计数器流 (`/api/sse/counter`)
- **用途**: 测试带参数的 SSE 接口
- **特点**: 可配置最大值和发送间隔
- **参数**: `max` (最大计数), `interval` (间隔毫秒)
- **适用场景**: 进度条、实时计数器测试

### 4. 随机数据流 (`/api/sse/random`)
- **用途**: 模拟物联网设备数据
- **特点**: 发送随机的传感器数据
- **数据类型**: 温度、湿度、随机值等
- **适用场景**: 物联网应用、实时监控系统测试

## 🛠️ 测试功能

### 配置选项
- **SSE 端点 URL**: 输入要测试的 SSE 接口地址
- **请求方法**: 支持 GET 和 POST 请求
- **请求体**: POST 请求时的 JSON 数据
- **数据解析**: 可选择是否解析 SSE 格式数据
- **JSON 解析**: 可选择是否解析 JSON 数据
- **自定义参数**: 数据前缀、分隔符、结束信号等

### 实时监控
- **连接状态**: 显示连接中、流式传输中、已完成等状态
- **实时消息**: 显示接收到的每条消息内容
- **连接日志**: 记录连接历史、耗时、消息数量等
- **错误处理**: 显示连接错误和异常信息

### 操作功能
- **开始连接**: 建立 SSE 连接并开始接收数据
- **取消连接**: 中断当前连接
- **清空日志**: 清除所有历史记录
- **清空消息**: 清除实时消息显示

## 🔧 技术实现

### Vite 插件
项目使用自定义的 Vite 插件 (`plugins/sse-plugin.ts`) 来提供 SSE 接口：

```typescript
// 插件会在开发服务器中添加以下路由：
// GET  /api/sse/stream   - 基础数据流
// POST /api/sse/chat     - 聊天对话流  
// GET  /api/sse/counter  - 计数器流
// GET  /api/sse/random   - 随机数据流
```

### 响应格式
所有 SSE 接口都遵循标准的 Server-Sent Events 格式：

```
Content-Type: text/event-stream
Cache-Control: no-cache
Connection: keep-alive

data: {"type": "message", "content": "数据内容"}

data: [DONE]

```

## 📝 使用示例

### 测试基础数据流
1. 选择"基础数据流"预设端点
2. 点击"开始连接"
3. 观察实时消息面板中的数据流
4. 查看连接日志中的统计信息

### 测试聊天对话
1. 选择"聊天对话流"预设端点
2. 在请求体中输入: `{"message": "你好"}`
3. 点击"开始连接"
4. 观察逐字符的流式回复效果

### 自定义测试
1. 选择"自定义端点"
2. 输入你的 SSE 接口 URL
3. 配置相应的解析选项
4. 开始测试

## ⚠️ 注意事项

1. **开发环境专用**: 这些模拟接口仅在开发环境中可用
2. **CORS 支持**: 所有接口都已配置 CORS，支持跨域访问
3. **连接管理**: 页面会自动处理连接断开和清理
4. **错误处理**: 网络错误和解析错误都会在界面中显示
5. **性能考虑**: 长时间运行可能会积累大量消息，建议定期清空

## 🐛 故障排除

### 连接失败
- 确保开发服务器正在运行
- 检查 URL 是否正确
- 查看浏览器控制台的错误信息

### 数据解析问题
- 检查数据格式是否符合预期
- 调整解析选项（数据前缀、分隔符等）
- 查看原始数据内容

### 性能问题
- 定期清空消息和日志
- 避免同时运行多个长时间连接
- 监控浏览器内存使用情况

## 📚 相关资源

- [Server-Sent Events 规范](https://html.spec.whatwg.org/multipage/server-sent-events.html)
- [MDN SSE 文档](https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events)
